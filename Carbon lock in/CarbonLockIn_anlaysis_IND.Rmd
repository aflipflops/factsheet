---
title: "Carbon Lock-in task CD LINKS"
author: "Aman Malik and Christoph Bertram"
date:   "15 October 2018"  
output: 
html_document:
  toc: true
  toc_depth: 2
pdf_document:
    keep_tex: true
---

```{r global settings, include=FALSE}
# setting global settings for knitr
# echo=TRUE/FALSE whether to include R source code in the output file
# knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path = "figure-carbonlockin/",cache = T,echo=F)
```

```{r comments knitr}
#### Some comments on knitr arguments ########
#warnings=FALSE, switches off all warnings from the trunk
#eval = FALSE, doesn't evaluate the chunk. Useful for packages that are not yet open-source, e.g., moinput
# include=FALSE, suppresses messages associated with loading packages
```

```{r req packages,message=FALSE, warning=FALSE, include=FALSE,results='hide'}
# library(quitte)
# library(moinput)
library(tidyverse)
library(reshape)
library(data.table)
library(RColorBrewer)
```

```{r all_data,include=FALSE,eval=FALSE,message=FALSE,purl=FALSE}
#read in data
# all <- invisible(fread("cdlinks_compare_20180508-032045.csv",header=TRUE)) #seems to be missing the V3 variants
# all <- invisible(fread("cdlinks_compare_20180810-010937.csv",header=TRUE)) #only MESSAGE
# all <- invisible(fread("cdlinks_compare_20180720-122848.csv",header=TRUE)) #only MESSAGE, AIM/CGE, IMAGE3.0, POLES, WITCH
all <- fread(input = "cdlinks_compare_20180615-153808.csv",header = T, sep = ',') #all V3 and V4 scens

#filter for desired set of time series
models <- unique(all$MODEL)
regions <- "IND" # unique(all$REGION)
scens <- unique(all$SCENARIO)
# How were these variables selected?
# variables <- as.character(read.csv2("plotstyles_CLI.csv")$name)
variables <- grep("Diagnostics",unique(all$VARIABLE),value=T,fixed = T)

all  <- all[all$MODEL %in% models & all$SCENARIO %in% scens & all$REGION %in% regions & !(all$VARIABLE %in% variables),]

all <- invisible(melt(all,measure.vars=names(all)[grep("[0-9]+",names(all))],variable.name = "period",variable.factor=FALSE))
all$period <- as.numeric(all$period)

all <- all[!period %in% c(1950,1955,1960,1965,1970,1975,1980,1985,1990,1995,2000,2001,2002,2003,2004,2006,2007,2008,2009,2011,2012,2013,2014,2016,2017,2018,2019,2021,2022,2023,2024,2026,2027,2028,2029,2031,2032,2033,2034,2036,2037,2038,2039,2041,2042,2043,2044,2046,2047,2048,2049,2051,2052,2053,2054,2056,2057,2058,2059,2061,2062,2063,2064,2066,2067,2068,2069,2071,2072,2073,2074,2076,2077,2078,2079,2081,2082,2083,2084,2086,2087,2088,2089,2091,2092,2093,2094,2096,2097,2098,2099,2101,2102,2103,2104,2106,2107,2108,2109)]
# Rename columns
setnames(all, "MODEL", "model")
setnames(all, "SCENARIO", "scenario")
setnames(all, "REGION", "region")
setnames(all, "VARIABLE", "variable")
setnames(all, "UNIT", "unit")

all  <- na.omit(all) # remove rows containing NAs

#make variables a factor, so that the order in facets can be manipulated easily
all$variable <- factor(all$variable)


all$model1 <- all$model
all$scenario1 <- all$scenario
all <- unite(all,col="modscen",c("model1","scenario1"),sep = " - ")
#make variables a factor, so that the order in facets can be manipulated easily
all$model <- factor(all$model)
all$scenario <- factor(all$scenario)
all$modscen <- factor(all$modscen)

#get rid of scenarios not interesting for us
scens_other <- c(grep("rec",unique(all$scenario),value=T),
                  grep("USD",unique(all$scenario),value=T),
              grep("Food",unique(all$scenario),value=T))
all <- all[!scenario %in% scens_other]

#get rid of V3 variants for models that have V4
v3scens <- grep("_V3",unique(all$scenario),value=T)
v4scens <- grep("_V4",unique(all$scenario),value=T)
v4mods <- unique(all[scenario %in% v4scens]$model)
all <- rbind(all[!model %in% v4mods],all[model %in% v4mods & scenario %in% v4scens])

all <- all %>% 
  filter(model!="GLOBIOM 1.0" )%>%
  mutate(model_scope=ifelse(model=="India MARKAL"|model=="AIM/Enduse 3.0","national","global"))
# Early scenario
early <- all[all$scenario %in% c("NPi2020_1000_V4","NPi2020_1000_V3","NPi2020_low_V3"),]
early <- add_column(early,scen_name = "Early action")
# Delay scenario
delay   <- all[all$scenario %in% c("INDC2030i_1000_V4","INDC2030i_1000_V3","INDC2030_low_V3"),]
delay <-  add_column(delay,scen_name = "Delayed action")
whole <- rbind(early,delay)
fwrite(whole,"")
save(whole,file="data_IND_2.RData")
```
```{r}
# load("data_IND.RData")
load("data_IND_2.RData")# with all variables except diagnostics
```


```{r historical data,include=FALSE,eval=FALSE}
# Relevant historical and bottom-up data 
# historical IEA data (PE, SE, FE,Trade), and CEDS emissions data
setConfig(forcecache = TRUE)
historical <- calcOutput("Historical",aggregate = F)# aggregate = T not working at the moment, use when available
historical <- collapseNames(historical,collapsedim = 1)
hist_IEA_CEDS <- as.data.frame(historical) 
hist_IEA_CEDS <- hist_IEA_CEDS[,-1]
# Format "Region"   "Year"  "Source"   "Variable" "Value"
names(hist_IEA_CEDS)[c(3,4)] <- c("Source","Variable")
# historical Renewable Energy Capacity data 
hist_IRENA_cap <- as.data.frame(calcOutput("Capacity",aggregate = T))
hist_IRENA_cap <- hist_IRENA_cap[,-1]
hist_IRENA_cap$Source <- "IRENA"
hist_IRENA_cap <- hist_IRENA_cap[,c(1,2,5,3,4)]
names(hist_IRENA_cap) <- names(hist_IEA_CEDS)

# nuclear bottom-up data
nuclear_IAEA <- as.data.frame(calcOutput("CapacityNuclear",aggregate = T))
nuclear_IAEA <- nuclear_IAEA[,-1]
nuclear_IAEA$Source <- "IEA"
nuclear_IAEA <- nuclear_IAEA[,c(1,2,5,3,4)]
names(nuclear_IAEA) <- names(hist_IEA_CEDS)
# coal plants bottom up data
coal_EndCoal <- as.data.frame(readSource("EndCoal"))
coal_EndCoal <- coal_EndCoal[,-1]
coal_EndCoal$Year <- "2018"
coal_EndCoal$Source <- "EndCoal"
coal_EndCoal <- coal_EndCoal[,c(1,2,5,3,4)]
names(coal_EndCoal) <- names(hist_IEA_CEDS)
# coal_EndCoal$Value <- as.character(coal_EndCoal$Value)
# IEA_WEO 2016 investment costs
capacity_costs_IEA <- as.data.frame(calcOutput("DiffInvestCosts",aggregate = T))
capacity_costs_IEA <- capacity_costs_IEA[,-1]
capacity_costs_IEA$Source <- "IEA_WEO"
capacity_costs_IEA <- capacity_costs_IEA[,c(1,2,5,3,4)]
names(capacity_costs_IEA) <- names(hist_IEA_CEDS)

# bringing all historical and bottom up data together; format- region, Variable Name, Year, Value
hist_and_botmup <- rbind(hist_IEA_CEDS,hist_IRENA_cap,nuclear_IAEA,capacity_costs_IEA,coal_EndCoal)   


# historical nuclear 
save(hist_and_botmup,file="HistandBotmup.RData")
```

```{r}
load("HistandBotmup.RData")
```

### Objective
The objective of the current task is to analyse and compare the structure of the Indian power sector under various mitigation regimes. It is often said that models are as good as the assumptions they are based on. 
The primary one would be to understand what consequences follow from certain assumptions. Or the other way round, which assumptions are causing the divergent behaviour. The secondary aim is to comment upon the plausibility of the assumptions used by these models. 

### Methodology

Global Integrated Assessment Models (IAMs) informed national energy-economy models and national IAMs in terms of national emission budgets consistent with long-term climate targets. National models often focus on nation-specific development issues, and have a stronger grasp on technologies and policies. Indian budgets were defined as they are because the national teams said they cannot produce scenarios with lower budgets.

#### Explanation of scenario names

| Scenario name |  National Models | Global Models  |
|---------------|------------------|----------------|
|Early action|Cumulative national emissions (budget/target) from 2011-2050, climate policy starts in 2020|Cumulative global emissions target of 1000GtC, climate policy starts in 2020|
|Delayed action|Cumulative national emissions (budget/target) from 2011-2050, climate policy starts in 2030|Cumulative global emissions target of 1000GtC, climate policy starts in 2030|

```{r generic plot functions}

myColors <- brewer.pal(11,"Paired")
#myColors <- rainbow_hcl(12)
names(myColors) <- as.character(unique(whole$model))

# Writing a generic function for a line-type ggplot
line_type_1 <- function(data_s,hist_s){
  ggplot()+
  geom_line(data = data_s , aes(x=period,y=value,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
   labs(
    x = "Year" ,
    y = paste(data_s$variable,"(",data_s$unit,")"),
    color = "Model Scope",
    linetype = "Scenario Type"
  ) +
  theme_bw()+ 
    coord_cartesian(xlim = c(2005,2050),ylim =c(1.3*min(data_s$value[data_s$period<2050]),1.3*max(data_s$value[data_s$period<2050])))+
     annotate(geom = "point",x = as.numeric(as.character(hist_s$Year)),y=hist_s$Value)
  # ggsave(file=paste(gsub(c("\\||\\/"),"_",unique(data_s$variable)),"_1",".png",sep=""))
}

line_type_2 <- function(data_s,hist_s){
  ggplot()+
  geom_line(data = data_s %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value,group=interaction(model,scen_name),linetype=scen_name,alpha=model),size=1.5) +
geom_line(data = data_s %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=scen_name),size=1)+
    labs(
    x = "Year" ,
    y = paste(data_s$variable,"(",data_s$unit,")"),
    color = "Global Model",
    alpha="National Model",
    linetype = "Scenario Type")+
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050),ylim =c(1.3*min(data_s$value[data_s$period<2050]),1.3*max(data_s$value[data_s$period<2050])))+
  scale_colour_manual(values = myColors)+
  # scale_colour_brewer(palette = "Set1")+
  scale_alpha_discrete(range = c(0.95, 0.60))+
  annotate(geom = "point",x = as.numeric(as.character(hist_s$Year)),y=hist_s$Value,colour = "red",size=1.5)
  # ggsave(file=paste(gsub(c("\\||\\/"),"_",unique(data_s$variable)),"_2",".png",sep=""))
  }

```

### Results and Discussion

#### CO2 Emissions- Total and Electricity sector
```{r co2 emissions,fig.show='hold',out.width="50%",warning=FALSE}

whole_emi <- whole[whole$variable=="Emissions|CO2",]

# historical emissions //India// Fossil Fuel and Industry
hist_emi <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2015),Variable =="Emi|CO2|Energy (Mt CO2/yr)") 

whole_emi_elec <- whole[whole$variable=="Emissions|CO2|Energy|Supply|Electricity",]
# historical emissions //India// Fossil Fuel and Industry
hist_emi_elec <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2015),Variable =="Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)") 
# share is the share of electricity emissions to total emissions

#line_type_1(whole_emi,hist_emi)
line_type_2(whole_emi,hist_emi)
#line_type_1(whole_emi_elec,hist_emi_elec)
line_type_2(whole_emi_elec,hist_emi_elec)

whole_emi_elec_share <- whole_emi_elec %>% 
  mutate(share=value/whole_emi$value) %>% 
  filter(period<=2050) 
whole_emi_elec_share$variable <- "Emissions|CO2|Energy|Supply|Electricity|Share"
whole_emi_elec_share$unit <- ""
whole_emi_elec_share$value <- whole_emi_elec_share$share
hist_emi_elec_share <- hist_emi_elec %>% 
  mutate(share=hist_emi_elec$Value/hist_emi$Value)
hist_emi_elec_share$Value <- hist_emi_elec_share$share
line_type_2(whole_emi_elec_share,hist_emi_elec_share)+coord_cartesian(ylim=c(0.75,0))+theme_dark()
```

**Total CO2 emissions**

* Both national models have no clear peaking year; in fact one model shows no peak in emissions but only a slight decrease in the growth of emissions.
* Most global models, on the other hand, show a peak year, which is either 2020 or 2030 depending upon a scenario. 

* There is a considerable spread of emissions in both national and global models. * National model emissions are higher than the global model emissions due to a higher carbon budget. 

* The two black dots are  energy sector historical emissions; which represent xx% of the total emissions of India. Most models, get this number right.

**Electricity CO2 emissions**

* Although national models have no peak in total emissions, they agree with global models that electricity emissions need to peak. 

* Power sector contributes largely toward mitigation. Global models show steep electricity sector decarbonisation after 2020 (in early action), or 2030 (in delayed action), most reaching zero or close to zero (with some even negative) emissions in 2050.

* However, national models show sector decarbonisation but gradual.
* Comparing with historical numbers, almost all except one, seem to get the electricity emissions correct.

**Share of Electricity sector to total emissions**

* Historical share of electricity emissions to total emissions around 50 %.

* Both national models concur on the decarbonisation potential of the electricity potential (~25%).

* Global models project a much higher decarbonisation potential.

The top two figure show the total CO2 emissions for India, including the landuse sector. The figure on the top left shows the two national models in blue and the 9 global models in red. The top right figure shows the same data but now also with the names of the models. The continuous lines show delayed action, i.e., climate mitigation starts in 2030 (before only NDCs), while early action scenarios, in dashed lines represent current policies in 2020 followed by cliamte mitigation. _Climate mitigation_ means that from that year on, the model needs to comply by a carbon budget which is achieved by having a carbon price.  From these two figures, it is clear that both national models have no clear peaking year; in fact one model shows no peak in emissions but only a slight decrease in the growth of emissions. Most global model, on the other hand, show a peak year, which is either 2020 or 2030 depending upon a scenario. There is a considerable spread of emissions in both national and global models. National model emissions are higher than the global model emissions due to a higher carbon budget. The two black dots are only sector historical emissions; which represent xx% of the total emissions of India. Most models, get this number right.

The bottom two figures show the share of emissions generated from electricity combustion. Here the inteesting finding is that although national models have no peak in total emissions, they agree with global models that electricity emissions need to peak. Unlike global models which immediately fast track on steep electricity sector decarbonisation after 2020 (in early action), or 2030 (in delayed action), most reaching zero or close to zero (with some even negative) emissions in 2050, the national models cut emissions but not drastically. We will later see, what is the structure of the power mix in 2050, and what is contributing these emissions: is there a shift from coal to gas?, from coal w/o CCS to coal with CCS. Comparing from historical numbers, almost all except one outlier seem to get the electricity emissions correct.

#### Total Secondary and Final Energy of Electricity
```{r SE_and_FE_elec,warning=FALSE,fig.show='hold',out.width="50%"}
plotvar_1 <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
             "Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Other",
             "Secondary Energy|Electricity|Geothermal",
             "Secondary Energy|Electricity|Ocean",
             "Secondary Energy|Electricity|Oil",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS")
plotvar_2 <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
             "Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS")
#whole_se_elec <- whole %>% filter(variable %in% plotvar_1 )
whole_se_elec <- whole %>% filter(variable %in% plotvar_2) %>% 
  group_by(modscen,model,scenario,period) %>%
  mutate(percentage=value*100/sum(value))


## adding all SE techs
## # Secondary Energy of Electricity
whole_se_elec_sum <- whole_se_elec %>% 
  group_by(scen_name,model,period,model_scope,unit,scenario,modscen) %>% 
  summarise(value=sum(value)) %>% 
  mutate(variable="Secondary Energy|Electricity")

whole_se_elec_sum <- whole %>% filter(variable=="Secondary Energy|Electricity ")
# Historical SE
hist_se_elec <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2015), Variable %in% grep("SE|Electricity",unique(hist_and_botmup$Variable),value=T,fixed = T))
hist_se_elec_sum <- hist_se_elec %>% 
  group_by(Region,Year) %>% 
  summarise(Value=sum(Value))
# FE
whole_fe_elec <- whole %>% filter(variable=="Final Energy|Electricity")
whole_fe_elec$period <- as.factor(whole_fe_elec$period)
whole_fe_elec$value <- whole_fe_elec$value/3.3



# Historical FE
hist_fe_elec <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2010),Variable =="FE|Electricity (EJ/yr)") 

var_fe <- c("Final Energy|Residential and Commercial|Electricity" ,  "Final Energy|Industry|Electricity",  "Final Energy|Other Sector|Electricity","Final Energy|Transportation|Electricity" )
whole_fe_elec_1 <- whole %>% filter(variable %in% var_fe,period<2051)
whole_fe_elec_1$variable <- shorten_legend(whole_fe_elec_1$variable)

ggplot()+ 
geom_line(data = whole_fe_elec_1 %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value,group=interaction(model,scen_name),linetype=scen_name,alpha=model),size=1) +
geom_line(data = whole_fe_elec_1 %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=scen_name))+
    labs(
    x = "Year" ,
    #y = paste(data_s$variable,"(",data_s$unit,")"),
    color = "Global Model",
    alpha="National Model",
    linetype = "Scenario Type")+
  theme_bw()+ 
  facet_grid(~variable)+
  coord_cartesian(xlim = c(2005,2050),ylim=c(0,15))+
  scale_colour_manual(values = myColors)+
  # scale_colour_brewer(palette = "Set1")+
  scale_alpha_discrete(range = c(0.95, 0.60))+
   scale_x_continuous(breaks=seq(2010, 2050, 20))+facet_wrap(~variable, labeller = labeller(variable = label_wrap_gen(10)))

#line_type_1(whole_se_elec_sum,hist_se_elec_sum)
line_type_2(whole_se_elec_sum,hist_se_elec_sum)
#line_type_1(whole_fe_elec,hist_fe_elec)
line_type_2(whole_fe_elec,hist_fe_elec)




```

**Total Secondary Energy of Electricity**


#### Secondary Energy by fuel/technology
```{r SE_Electricity_type,warning=FALSE,fig.show='hold',out.width="50%"}
# SE|Coal|Electricity
  whole_se_elec_coal <- whole %>% filter(variable=="Secondary Energy|Electricity|Coal")
# SE|Gas|Electricity
whole_se_elec_gas <- whole %>% filter(variable=="Secondary Energy|Electricity|Gas")


hist_se_elec_coal <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2015), Variable=="SE|Electricity|Coal (EJ/yr)")
hist_se_elec_gas <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2015), Variable=="SE|Electricity|Gas (EJ/yr)")

source("plotstyle.R")

ggplot()+
  geom_bar(data=whole_fe_elec %>% filter(period==2030) , aes(x=scen_name,y=value,group=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(
    x="Scenario",
    y = "Final Energy (EJ/yr) in 2030")


ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2030) , aes(x=scen_name,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(
    x="Scenario",
    y = "Secondary Energy (EJ/yr) in 2030")
ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2050) , aes(x=scen_name,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(
    x="Scenario",
    y = "Secondary Energy (EJ/yr) in 2050")
# 
# ggplot()+
#   geom_bar(data=whole_se_elec %>% filter(period==2050) , aes(x=scen_name,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar_1))+
#   facet_grid(.~model)+
#     theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
#   labs(x="Scenario",
#     y = "Secondary Energy (EJ/yr) in 2050")

ggplot(data=whole_se_elec %>% filter(period %in% c(2030,2050)))+
  geom_bar(aes(x=as.factor(period),y=value,group=variable,fill=variable),position = position_stack(),stat = "identity")+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(
    x="Period",
    y = "Secondary Energy (EJ/yr)")
    


ggplot(data=whole_se_elec %>% filter(period %in% c(2030)))+
  geom_bar(aes(x=as.factor(period),y=percentage,group=variable,fill=variable),position = position_stack(),stat = "identity")+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Secondary Energy shares in 2030")


ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period %in% c(2030),model_scope=="national"),aes(x=as.factor(period),y=percentage,group=variable,fill=variable),position = position_stack(),stat = "identity",color="red",stroke = 2)+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Secondary Energy shares in 2030")+
    geom_bar(data=whole_se_elec %>% filter(period %in% c(2030),model_scope=="global"),aes(x=as.factor(period),y=percentage,group=variable,fill=variable),position = position_stack(),stat = "identity")+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)
    
    
   

ggplot()+
  geom_line(data = whole %>% filter(period<2050,variable=="Secondary Energy|Electricity|Coal|w/o CCS") , aes(x=period,y=value,group=interaction(model,scen_name),linetype=model_scope,color=model,size=0.8))+facet_grid(~scen_name)+
 labs(
    x = "Year",
    y = "Secondary Energy|Electricity|Coal (EJ/yr)"
    )+ theme_bw()+
   annotate("point",x=c(2005:2015),y=hist_se_elec_coal$Value)+scale_color_manual(values = myColors)

ggplot()+
  geom_line(data = whole %>% filter(period<2050,variable=="Secondary Energy|Electricity|Gas") , aes(x=period,y=value,group=interaction(model,scen_name),linetype=model_scope,color=model))+facet_grid(~scen_name)+
 labs(
    x = "Year",
    y = "Secondary Energy|Electricity|Gas (EJ/yr)" )+ theme_bw()+
   annotate("point",x=c(2005:2015),y=hist_se_elec_gas$Value)+
  scale_color_manual(values = myColors)


```


* Decarbonisation of the electricity sector can take place in a multitude of ways. Coal plants can be retired, new CCS plants can be construcuted, existing plants can be retrofitted, and simply moving to renewable energy, i.e., Hydro, solar, wind, and nuclear. 

* A few models already show some coal with CCS potential in 2030, although the policy support is currently non-existent in India. The same is true for gas with CCS. The national model AIM/EndUse seems to be quite optimistic about the CCS potential in India. 

* A big 'question-mark' is the potential of gas as a bridge-fuel. The share of gas in the SE|Electricity has been historically very low. This is because India has very limited gas reserves. Moreover, gas finds additional uses- as a clean-cooking fuel (substituting biomass), and as a cleaner fuel for vehicles, especially public transport. The economics and socio-politics of gas as fuel, and gas infrastructure means unpredictability. This is also conveyed in scenario results (See SE|Electricity|Gas). Models showing exponential increase in gas based electricity are probably too unrealistic.

* The national model MARKAL stands out in 2050, with exceptionally large amounts of coal without CCS.

* Most models agree on the total SE: Electricity for 2030 in delay action, don't agree on early action. This means that most models capture near term electricity requirement in the absence of climate policies fairly well.

* How is Electricity demand affected by climate policy?
Three types- models that are little or not affected by climate policy, models impacted (significant change in FE), and models which show an increase in FE. A mitigation policy leads to higher prices of electricity, and depending on the type of conusmer you (residential vs. commercial vs. industry), and the income inequality, one is affected differently by climate policy. But cliamte policy not only includes shift to renewables but also efficiency gains. An increase in effoicency means that for the same output there is less need of electricity. 

  
For some models, an early action scenaio leads to a decrease in total SE in 2030. There is a dip in SE: Electricity because the FE: elec demand also decreases. So climate policies lead to a decrease in total energy demand. Models react differently to how climate policy affects total electriicty demand. Why would the Fe increase in early action scenarios?
A climate policy increases the cost of electricity, of course depending upon the relative prices of the 

  

The top two figures show the share of emissions from the electricity sector compared to the total emissions. The message here is similar to the last two figures. That both national and global models show power sector decarbonisation potential (compare here with other sectors), has already been mentioned above.
Decarbonisation of the electricity sector can take place in a multitude of ways - coal plants be retired, new coal plants are CCS enabled, and simply moving to renewable energy, i.e., Hydro, solar, wind, and nucler. The question is what is behind the emissions in the electricity sector in 2050. Taking Primary energy as a proxy for emissions by type of fuel, for early and delayed action, the plot is shown at the bottom. Out of the two national models from India in the modeling excercise, AIM/Enduse 3.0 and India Markal, only the former has CCS available as an option. Both national models show a resurgence of coal at some later part of time. For AIM/Enduse 3.0 this might be because of Coal CCS, but it is still unclear for _Markal_. In general, an early mitigation policy has almost no effect on coal output to power plants (see early action), but strangely PE decreases in 2030 before resurging again in 2035. For a delayed action, the dip in PE is small. Another interesting finding is that although the both models have comparable CO2 emissions from the electricity sector till 2020, their PE are quite different (maybe due to efficiency of plants?). For the global models, the pattern seems to be robust in delay scenarios, most project zero PE in 2050; meaning that the potential for coal CCS till is very limited. The pictures get hazy in the early action scenario for the time period between 2020 and 2050, with a wide range in the rates of decarbonisation and many having apparently coal CCS in the mix or coal w/o CCS and BECCS (but then again will BECCS become economically favourable before coal CCS?). Why does REMIND has such high PE Coal Elec values in 2030 and before? Why do almost all global models have much higher PE than national models? Should we convert PE Coal to tonnes of coal mined and see with current numbers? 
The picture for gas seems to be quite polar. India has much more coal than gas resources, and the push for clean cooking and vehicles/public transport using compressed natural gas, means that gas based electricity is expensive. The question is will India see transition from coal to gas based power, commonly seen in European nations? The two national models have completely divergent views on the same, including the global models.
This might be due to Coal CCS 
This might be the reason for the resurgence of coal in both the early and delay scenarios, albeit in a lower amount in the early action, due to early mitigation. The second model, India Markal 
In both the early and delayed scenarios, the national models show 



What is Secondary Energy? It is the energy that is attained from the combustion of primary fuel into electricity. This is true for the fuels oil, gas, caol and biomass. For solar, as I see it in REMIND, the PE|Solar is the same as SE|Electricity|Solar till 2030 and then it diverges, but PE is always higher. Similar behavior for Wind. But more or less the PE numbers are same as SE. What is the role of SE in the energy sector? 

Final energy|Elec is the point where energy costs are given, it is the electricity coming at the meter. 
* The Historical values agree well with past model data. This means that the definition across models is very similar. 
* Large deviation in the Final Energy in 2050. Final energy increases because of basic demand increase, so people need more energy as incomes increase (country as a whole), then electricity demand depends on the structure of the economy(service or manufacturing, hybrid etc.), and then how much substitution is possible with solids e.g., in industry.  Still most models have around 10-15 EJ/y FE:Elec , a couple between 20 and 25, and one has 30 EJ. The national model AIM-Enduse sitts quite well in the range of global model results. 
* The total SE:Elec values seem to have a higher spread compared to FE, the pattern for SE and FE is not similar! This can be later explored in the Transmission losses which is the share of the FE with the PE.
* Why does AIM/Enduse do well in Finaly Energy numbers but not in Secondary Energy (reporting or definition error).


** Secondayry energy by fuel type**
* Plot only early action, then only delay, then compare the first wit the other. Do this excercise for both 2030 and 2050, then comment on the difference between 2030 and 2050.

** Early action** 
AIM- similar shares of Wind and Hydro; similar shares of nuclear and solar, more wind than solar. coal less than each renewable energy, gas lowest.
AIM/ENDUSE: Similar shares for solar, gas, and coal w o CCS. Coal w CCS similar share to nuclear and hydro. much more solar potential than wind. 
COPPE: largest share of hydro, similar gas and coal values.very low nuclear and wind, almost no solar.
DNE: almost all gas, next is nuclear. Very low wind, solar, and hydro potential. 
IMAGE: Same nuclear as coal. hydro more than solar or wind (also combined solar and wind). 
INDIA MARKAL: Arund 60% coal share, 20%solar, very little nuclear, wind half of solar
Across all early action scenarios, AIM v2.1 and AIM/CGE have exactly the energy mix. 

* Models are  

| Model Name | Early action  | Delay action  |
|---------------|------------------|----------------|
||Cumulative national emissions (budget/target) from 2011-2050, climate policy starts in 2020|Cumulative global emissions target of 1000GtC, climate policy starts in 2020|
|Delayed action|Cumulative national emissions (budget/target) from 2011-2050, climate policy starts in 2030|Cumulative global emissions target of 1000GtC, climate policy starts in 2030|

Questions:

Why doesn't the model SE|Elec match with the historical data? Seems to be a systematic shift?. Also , the national AIM Enduse seems to be way off. Add this to the questions you will ask them.

#### Transmission losses
```{r Elec_Efficiency,warning=FALSE,fig.show='hold',out.width="50%"}
whole_fe_elec <- whole_fe_elec %>% 
  arrange(model,scenario)
whole_se_elec_sum <- whole_se_elec_sum %>% 
  arrange(model,scenario)

 whole_se_elec_eff <- transform(whole_se_elec_sum,efficiency=whole_fe_elec$value/whole_se_elec_sum$value) 
#names(whole_se_elec_eff)[8] <- "value"

hist_elec_eff <- transform(hist_se_elec_sum,efficiency=hist_fe_elec$Value/Value)
#names(hist_elec_eff)[4] <- "Value"

# ggplot()+
#   geom_line(data = whole_se_elec_eff , aes(x=period,y=efficiency,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
#    labs(
#     x = "Year" ,
#     y = "Elec. Efficiency",
#     color = "Model Scope",
#     linetype = "Scenario Type"
#   ) +
#   theme_bw()+ 
#   coord_cartesian(xlim = c(2005,2050))+
#   annotate(geom = "point",x =c(2005:2015),y=hist_elec_eff$efficiency)

ggplot()+
  geom_line(data = whole_se_elec_eff %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=efficiency,group=interaction(model,scen_name),linetype=scen_name,alpha=model)) +
geom_line(data = whole_se_elec_eff %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=efficiency,group=interaction(model,scen_name),color=model,linetype=scen_name))+
    labs(
    x = "Year" ,
    y = "Elec. Efficiency",
    color = "Global Model",
    alpha="National Model",
    linetype = "Scenario Type")+
  theme_bw()+
  coord_cartesian(xlim = c(2005,2050))+
  annotate(geom = "point",x =c(2005:2015),y=hist_elec_eff$efficiency)

# line_type_1(whole_se_elec_eff,hist_elec_eff,c(2005:2015))
# line_type_2(whole_se_elec_eff,hist_elec_eff,c(2005:2015))
# #hist_fe <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005:2015),Variable =="FE|Electricity (EJ/yr)") 
# ggplot(whole_fe %>% filter(scen_name=="Early action" & period<2050))+
#   geom_line(aes(x = period,y = value,color=model_scope,linetype=model)) +
#   facet_grid(~variable)

# line_type_1(whole_fe,hist_fe_elec)
# line_type_2(whole_fe,hist_fe_elec)
#### Coal capacity, generation and  
```

#### Coal Capacity
```{r coal_plant_eff,warning=FALSE,fig.show='hold',out.width="50%"}
## Efficiency of coal plants


whole_pe_coal_elec <- whole %>%
                  filter(variable=="Primary Energy|Coal|Electricity")%>% 
                  arrange(model,scenario)
whole_se_coal_elec <- whole %>% 
                      filter(variable %in% c("Secondary Energy|Electricity|Coal|w/o CCS","Capacity|Electricity|Coal|w/ CCS"), model!="COPPE-COFFEE 1.0") %>%
                      arrange(model,scenario)

whole_se_coal_elec_eff <- transform(whole_se_coal_elec,efficiency=whole_se_coal_elec$value/whole_pe_coal_elec$value) 

# Coal capacity
whole_coal_cap <- whole %>% filter(variable %in% c("Capacity|Electricity|Coal|w/o CCS","Capacity|Electricity|Coal|w/ CCS")) %>% group_by(region,unit,period,modscen,model_scope,scenario,model_scope,model,scen_name) %>% 
  summarise(value=sum(value)) %>% 
  mutate(variable="Capacity|Electricity|Coal")

  
# hist_coal_cap <- hist_and_botmup%>%
#   filter(grepl("Operating|Constr|Announced",Variable),Region=="IND")
# Current Capacity
hist_coal_cap_1 <- hist_and_botmup%>% filter(Region=="IND", Variable =="Operating")
hist_coal_cap_1$Value <- hist_coal_cap_1$Value/1000
hist_2 <- data.frame(energy=rep("coal",11),Year=c(2006:2016),value=c(77003.79,
80187.53,
84981.5,
89040.04,
99433.85,
111442.05,
132824.89,
152416.62,
168973.58,
189013.91,
184587
))

  # line_type_1(whole_coal_cap,hist_coal_cap)
  line_type_2(whole_coal_cap,hist_coal_cap_1)+
    annotate("point",y = hist_2$value/1000,x=hist_2$Year,color="red")+
 geom_hline(yintercept=hist_coal_cap_1$Value)+
    geom_text(x=2015,y=240,aes(label="Operating"),check_overlap = T)+
    geom_hline(yintercept = hist_coal_cap_1$Value+hist_coal_cap$value[hist_coal_cap$variable=="Construction"]/1000)+
    geom_text(x=2015,y=280,aes(label="Under Costruction"),check_overlap = T)+
      geom_hline(yintercept = hist_coal_cap_1$Value+hist_coal_cap$value[hist_coal_cap$variable=="All future"]/1000)+
        geom_text(x=2015,y=340,aes(label="Under construction + planned"),check_overlap = T)

  
  
ggplot()+
  geom_line(data = whole_se_coal_elec_eff , aes(x=period,y=efficiency,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
   labs(
    x = "Year" ,
    y = "Plant efficiency",
    color = "Model Scope",
    linetype = "Scenario Type"
  ) +
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050))+
  annotate("line",y=300,x = 5)
```
  
#### Cumulative Emissions 2011-2050
```{r cum_emi,warning=FALSE}
whole_cum <- whole_emi %>% 
  filter(period>2010 & period<2055) %>% 
  group_by(model,scen_name) %>% 
  mutate(cumsum=cumsum(value)/1000) %>% 
  arrange(cumsum,desc(cumsum))


# try 1
ggplot()+
  geom_bar(data=whole_fe_elec %>% filter(period==2030) , aes(x=model,y=value, group=interaction(model,scen_name),fill=scen_name),position="dodge", stat = "identity")+
  labs(
    x = "Model name" ,
    y = "Final Energy of electricity in 2030",
    fill = "Scenario Type",
    alpha = "Model Scope"
 
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  
  #scale_alpha_discrete(range = c(0.95, 0.55))
  facet_grid(~model_scope,scales="free",space = "free_x")


```

#### Capital Cost of Solar PV vs. Coal
```{r capital cost,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE}
#plot capital cost
# plotvar <- c("Capital Cost|Electricity|Solar|PV")
plotvar <- c("Capital Cost|Electricity|Coal|w/o CCS","Capital Cost|Electricity|Solar|PV" )
whole_cap_cost <- whole[whole$variable==plotvar,]
localrate = 0.015 #https://www.xe.com/currencycharts/?from=INR&to=USD&view=10Y
whole_cap_cost[whole_cap_cost$model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value <- whole_cap_cost[whole_cap_cost$model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value*localrate
proj_iea <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2015:2040),Variable =="pc",Source=="IEA_WEO") 

line_type_1(whole_cap_cost,proj_iea)
line_type_2(whole_cap_cost,proj_iea)
```

### Cumulative Coal Capacity
Make a chart showing the current coal capacity in various models, the added capacity in various model vs. the planned and under-construction capacity.
```{r}
whole_coal_cap <- whole %>%  filter(variable=="Capacity|Electricity|Coal|w/o CCS" )
whole_coal_cap_add <- whole_coal_cap %>% 
  filter(period %in% c(2020,2030)) %>% 
  group_by(model,modscen,scen_name,model_scope) %>% 
  arrange(period) %>% 
  summarise(add=diff(value)) %>% 
  mutate(period="2020-2030")

whole_coal_cap <- whole %>%  filter(variable=="Capacity|Electricity|Coal|w/o CCS" )
whole_coal_cap_add <- whole_coal_cap %>% 
  filter(period %in% c(2020,2040)) %>% 
  group_by(model,modscen,scen_name,model_scope) %>% 
  arrange(period) %>% 
  summarise(add=diff(value)) %>% 
  mutate(period="2020-2030")
  

line_type_2(whole_coal_cap_add,hist_emi)


hist_coal_cap <- hist_and_botmup %>% filter(Source=="EndCoal",Region=="IND", Variable %in% c("Operating","Construction","Announced + Pre-permit + Permitted")) %>% 
  add_row(Variable="All future",Year=2018,Value=102699)
names(hist_coal_cap)[4] <- "variable"
names(hist_coal_cap)[5] <- "value"
hist_coal_cap$Value <- hist_coal_cap$value
  mutate(new=Value[Variable=="Construction"]+Value[Variable=="Announced + Pre-permit + Permitted"])


ggplot()+
  geom_bar( data = hist_coal_cap %>% filter(!variable %in% c("Operating","All future")),aes(x = Year, y = value/1000,alpha=variable), stat="identity",width = 0.6)+
  geom_bar(data = whole_coal_cap_add %>% filter(period<2031),aes(x= scen_name,y= add,group=interaction(model,scen_name),fill=model),stat = "identity",position = "dodge",color="black")+scale_color_manual(values = myColors)+labs(
    y = " Coal capacity (GW)",
    x=""
  )+scale_alpha_discrete(range = c(0.95, 0.50))+  scale_x_discrete(labels = function(variable) str_wrap(variable, width = 10))+theme_bw()


ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period %in% c(2030),model_scope=="national"),aes(x=as.factor(period),y=percentage,group=variable,fill=variable),position = position_stack(),stat = "identity",color="red",stroke = 2)+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Secondary Energy shares in 2030")+
    geom_bar(data=whole_se_elec %>% filter(period %in% c(2030),model_scope=="global"),aes(x=as.factor(period),y=percentage,group=variable,fill=variable),position = position_stack(),stat = "identity")+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)

```




#### Total Demand and Demand in various sectors
```{r FE, include=FALSE}
plotvar <- c("Final Energy","Final Energy|Industry","Final Energy|Residential and Commercial","Final Energy|Transportation","Final Energy|Other","Final Energy|Other Sector")
whole_fe <- whole[whole$variable %in% plotvar,]
```

```{r}
#Power generation in 2030
# all technologies
plotvar <- grep("Secondary Energy|Electricity|",unique(whole$variable),value=T,fixed = T)
whole_se_elec <- whole %>% filter(variable %in% plotvar )
whole_se_elec_tot <- whole %>% filter(variable== "Secondary Energy|Electricity")
source("plotstyle.R")

ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2030) , aes(x=scen_name,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar))+
  facet_grid(~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))

ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2050) , aes(x=scen_name,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar))+
  facet_grid(~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))  

# ggplot()+
#   geom_bar(data=whole_se_elec , aes(x=scen_name,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+scale_fill_manual(values=plotstyle(plotvar))+
#   facet_grid(~model)+theme(strip.text = element_text(size=8,angle = 90))
   
# ggplot()+
#   geom_col(data=whole_se_elec,aes(x=modscen,y=value,group=interaction(model,variable),fill=variable)) + coord_flip()

  # scale_fill_manual(values=plotstyle(plotvar)) + xlab("Model - Scenario") +
  # geom_text(data=whole_se_elec,aes(x=model,y=25,label=model_scope,angle=90,hjust="right"),color="red",size=2.5)+
  # geom_point(data=whole_se_elec_tot,aes(x=modscen,y=value))+ylim(0,25)+
  # theme_bw()+ylab("Secondary Energy Electricity in 2030 (EJ/yr)")

```
#### Capacity Factor
The capacity factor of a plant is defined as the fraction of time it is available in a year for electricity generation.$$  $$

```{r}
# removing observations in whole_se_coal that are not in whole_cap_coal
 
# whole_se_coal <- whole %>% 
#   filter(!modscen %in% c("COPPE-COFFEE 1.0 - NPi2020_1000_V3","AIM/Enduse 3.0 - INDC2030_low_V3","COPPE-COFFEE 1.0 - INDC2030i_1000_V3")) %>% 
#   mutate(cap_factor=value*277777.778/(whole_coal_cap$value*8760)) %>%   
#   mutate(capacity=whole_coal_cap$value) %>% 
#   filter(capacity!=0)
#                         
# ggplot()+
#   geom_line(data = whole_se_coal, aes(x=period,y=cap_factor,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
#    labs(
#     x = "Year" ,
#     y = "Capacity Factor",
#     color = "Model Scope",
#     linetype = "Scenario Type"
#   ) +
#   theme_bw()+ 
#   coord_cartesian(xlim = c(2005,2050))

```




```{r}
head(hist_and_botmup%>%
  filter(grepl("Operating|Constr|Announced",Variable),Region=="IND"))
```

# Power capacity in 2030
```{r power_cap}

plotvar_1 <- c("Capacity|Electricity|Biomass|w/ CCS",
             "Capacity|Electricity|Biomass|w/o CCS",
              "Capacity|Electricity|Hydro",
              "Capacity|Electricity|Solar",
             "Capacity|Electricity|Wind",
             "Capacity|Electricity|Solar|PV",
             "Capacity|Electricity|Nuclear"
             
             )
#Power capacity in 2030
source("plotstyle.R")
#plotvar <- grep("Capacity|Electricity|",unique(whole$variable),value=T,fixed = T)
# plotvar <- plotvar[-c(13,14)]#removing Solar|PV and Wind|Onshore


whole_cap_elec <- whole[whole$variable %in% plotvar_1 & whole$period %in% c(2030,2050),]
coal <- hist_and_botmup%>%
  filter(grepl("Operating|Constr|Announced",Variable),Region=="IND")
whole_j <- whole[whole$period %in% c(2030,2050) & whole$variable %in% "Capacity|Electricity|Solar|PV" & whole$model %in% c("AIM V2.1","AIM/CGE","DNE21+ V.14", "REMIND-MAgPIE 1.7-3.0"),]
# whole_j <- whole[whole$period==2030 & whole$variable %in% "Capacity|Electricity|Solar|PV" ,]
# whole_j_2 <-  whole[whole$period==2030 & whole$variable %in% "Capacity|Electricity|Solar" ,]
#what <- grep("Wind",unique(whole$variable),value=T)
whole_j$variable <- "Capacity|Electricity|Solar"
whole_cap_elec <- rbind(whole_cap_elec,whole_j) %>% 
  filter(variable!="Capacity|Electricity|Solar|PV")
# whole_cap_elec$variable <- shorten_legend(whole_cap_elec$variable)
ind_capacity <- hist_and_botmup %>% 
  filter(Source=="IRENA",Variable %in% c("spv","wind","hydro"),Region=="IND",Year==2016)
ind_capacity$Value <- ind_capacity$Value*1000
ind_capacity$Variable <- gsub("spv","Solar",x = ind_capacity$Variable)
ind_capacity$Variable <- gsub("hydro","Hydro",x = ind_capacity$Variable)
ind_capacity$Variable <- gsub("wind","Wind",x = ind_capacity$Variable)

whole_cap_elec_tot <- whole[whole$period==2030 & whole$variable %in% "Capacity|Electricity" ,]
whole_cap_elec <- whole_cap_elec %>% 
  filter(variable %in% c("Solar","Wind","Hydro")) %>% 
  group_by(variable) %>% 
  mutate(projected_add=value-ind_capacity$Value)



ggplot()+
  geom_bar(data=whole_cap_elec , aes(x=reorder(scen_name,value),y=value,group=variable,fill=variable),position = "stack",stat = "identity")+facet_grid(scen_name~model)
  
ggplot()+
  geom_bar(data=whole_cap_elec %>% filter(period %in%   c(2030),model_scope=="national"),aes(x=as.factor(period),y=value,group=variable,fill=variable),position = "fill",stat = "identity",color="red")+
  facet_grid(scen_name~model)+
    scale_fill_manual(values=plotstyle(plotvar_1))+
      theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Installed capacity shares in 2030")+
    geom_bar(data=whole_cap_elec %>% filter(period %in% c(2030),model_scope=="global"),aes(x=as.factor(period),y=value,group=variable,fill=variable),position = "fill",stat = "identity")+
    scale_fill_manual(values=plotstyle(plotvar_1))+
  facet_grid(scen_name~model)


  




# ggplot()+
#   geom_bar(data=whole_cap_elec %>% filter(scen_name=="Early action"), aes(x=reorder(model,value),y=value,group=interaction(model,modscen),fill=variable),position = "dodge")+coord_flip()+scale_fill_manual(values=plotstyle(plotvar))

```


```{r}
ggplot()+
  geom_col(data=whole_cap_elec,aes(x=model,y=value,group=interaction(scen_name,variable,model),fill=variable))+
  scale_fill_manual(values=plotstyle(plotvar_1))+
  xlab("Model - Scenario")+
  geom_text(data=whole_cap_elec,aes(x=model,y=1200,label=scen_name,hjust="right"),color="red",size=2.5)+coord_flip()+
  ylim(0,1300)+ theme_bw()+ylab("Power Capacity (GW)")+ 
# geom_point(data=whole_l,aes(x=modscen,y=value))
ggsave(file="Capacity_IND.png",width=8)
```
```{r}
whole_pe_fossil <- whole %>% filter(variable %in% c("Primary Energy|Coal|Electricity","Primary Energy|Gas|Electricity"))

# "Primary Energy|Coal|w/ CCS","Primary Energy|Coal|w/o CCS" ,"Primary Energy|Gas|w/ CCS"  , "Primary Energy|Gas|w/o CCS","Primary Energy|Oil|w/ CCS" , "Primary Energy|Oil|w/o CCS",
hist_pe_tot <- hist_and_botmup %>% filter(Variable=="PE (EJ/yr)",Year %in% c(2005:2015),Region=="IND")
hist_pe_coal_elec <- hist_and_botmup %>% filter(Variable=="PE|Coal|Electricity (EJ/yr)",Year %in% c(2005:2015),Region=="IND")
hist_pe_gas_elec <- hist_and_botmup %>% filter(Variable=="PE|Gas|Electricity (EJ/yr)",Year %in% c(2005:2015),Region=="IND")



ggplot()+
  geom_line(data = whole_pe_fossil %>% filter(period<2050,variable=="Primary Energy|Coal|Electricity") , aes(x=period,y=value,group=interaction(model,scen_name),linetype=model_scope,color=model))+facet_grid(variable~scen_name)+
 labs(
    x = "Year"
    )+ theme_bw()+
   annotate("point",x=c(2005:2015),y=hist_pe_coal_elec$Value)+scale_color_manual(values = myColors)

ggplot()+
  geom_line(data = whole_pe_fossil %>% filter(period<2050,variable=="Primary Energy|Gas|Electricity") , aes(x=period,y=value,group=interaction(model,scen_name),linetype=model_scope,color=model))+facet_grid(variable~scen_name)+
 labs(
    x = "Year")+ theme_bw()+
   annotate("point",x=c(2005:2015),y=hist_pe_gas_elec$Value)+scale_color_manual(values = myColors)

ggplot()+
  geom_line(data = whole %>% filter(variable == "Primary Energy",period<2050,!model %in% c("India MARKAL")), aes(x=period,y=value,group=interaction(model,scen_name),color=model))+facet_grid(variable~scen_name)+
 labs(
    x = "Year")+ theme_bw()+annotate("point",x=c(2005:2015),y=hist_pe_tot$Value)+
scale_color_manual(values = myColors)

```




<!-- #### Share of Electricity to total CO2 Emissions   -->
<!-- ```{r,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE} -->
<!-- # Share of Electricity to total CO2 Emissions -->
<!-- whole_emi_elec_share <- whole_emi_elec %>%  -->
<!--   mutate(share=value/whole_emi$value) %>%  -->
<!--   filter(period<=2050)  -->
<!-- whole_emi_elec_share$variable <- "Emissions|CO2|Energy|Supply|Electricity|Share" -->
<!-- whole_emi_elec_share$unit <- "" -->
<!-- whole_emi_elec_share$value <- whole_emi_elec_share$share -->
<!-- hist_emi_elec_share <- hist_emi_elec %>%  -->
<!--   mutate(share=hist_emi_elec$Value/hist_emi$Value) -->
<!-- hist_emi_elec_share$Value <- hist_emi_elec_share$share -->
<!-- line_type_1(whole_emi_elec_share,hist_emi_elec_share,c(2005,2010)) -->
<!-- line_type_2(whole_emi_elec_share,hist_emi_elec_share,c(2005,2010)) -->

<!-- # ggplot()+ -->
<!-- #   geom_bar(data=whole_emi_elec_share %>% filter(period==2010),aes(x=reorder(model,share),y=share, group=interaction(model,scen_name),fill=scen_name,alpha=model_scope),position="dodge", stat = "identity")+coord_flip()+ -->
<!-- #   scale_alpha_discrete(range = c(0.95, 0.65))+ -->
<!-- #   labs( -->
<!-- #     x = "Year" , -->
<!-- #     y = "CO2 Emissions Electricity (Gt/yr)") -->

<!-- ``` -->
<!-- #### Final Energy of Electricity -->
<!-- ```{r FE_Electricity,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE} -->
<!-- plotvar <- "Final Energy|Electricity" -->
<!-- whole_fe_elec <- whole[whole$variable==plotvar,] -->
<!-- hist_fe_elec <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005,2010),Variable =="FE|Electricity (EJ/yr)")  -->

<!-- line_type_1(whole_fe_elec,hist_fe_elec,c(2005,2010)) -->
<!-- line_type_2(whole_fe_elec,hist_fe_elec,c(2005,2010)) -->
<!-- ``` -->

<!-- #### Secondary Energy of Electricity -->
<!-- #```{r SE_Electricity,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE} -->
<!-- # all tech with secondary energy of electricity -->
<!-- plotvar <- grep("Secondary Energy|Electricity|",unique(whole$variable),value=T,fixed = T) -->
<!-- whole_se_elec <-whole[whole$variable %in% plotvar,] -->
<!-- ## adding all SE techs -->
<!-- whole_se_elec_sum <- whole_se_elec %>%  -->
<!--   group_by(model,scenario,scen_name,period,model_scope,unit) %>%  -->
<!--   mutate(value=sum(value)) -->
<!-- whole_se_elec_sum$variable <- "Secondary Energy|Electricity" -->
<!-- # Sum over all variables to get secondary energy electricity -->
<!-- hist_se_elec <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005,2010), Variable %in% grep("SE|Electricity",unique(hist_and_botmup$Variable),value=T,fixed = T)) -->
<!-- hist_se_elec_sum <- hist_se_elec %>%  -->
<!--   group_by(Region,Year) %>%  -->
<!--   summarise(Value=sum(Value)) -->

<!-- line_type_1(whole_se_elec_sum,hist_se_elec_sum,c(2005,2010)) -->
<!-- line_type_2(whole_se_elec_sum,hist_se_elec_sum,c(2005,2010)) -->
<!-- ``` -->

<!-- Global models have a 1000 Gt carbon budget (mitigation policy for 2C  between 2011-2100. They run the global models and get particular emission trajectories for India. These models minimise costs, so often developing nations, where mitigation is cheaper and most of the infrastructure has yet to be built get a disproportionate amount of the mitigation effort.  For the well-below 2C target, cumulative 20112100 net emissions are limited to 1000Gt CO2, whereas the 1.5C scenario has a budget of 400GtCO2. These budget values represent a likelihood of 66% of staying below 2C throughout the 21st century in the 'well below 2C' scenarios, as well as 66% of staying below 1.5C after 2100 in the 1.5C scenario -->

<!-- For the global models, the carbon budget for both the early and delay mitigation scenarios is the same, but till 2100 (and hence it cannot be seen till 2050). For them, the cumulative emissions in 2050 are higher. That the emissions rise without a cliamte policy in place is no surprise, but what is the cause of these rise in emissions? -->

<!-- The national budgets were decided after discussion with the global teams- The global teams gave them a number that they could work with?.  -->

<!-- ? Recapitulate how the national budgets were calculated -->


<!-- Each of the two CO2 budget are achieved by iteratively adjusting a global carbon price that is assumed to grow with 5% p.a. until 2060 and linearly thereafter. Regionally fragmented carbon prices in 2020 (for the cost-effective scenarios) or 2030 (for the other scenarios) converge to the globally harmonized carbon price over a 20 year period (see figure S2 in the supplementary material). GHGs other than CO2 are priced equivalently to CO2 throughout the 21st century based on 100 year global warming potentials from IPCC's Fifth Assessment Report. -->

<!-- #### Secondary Energy from Coal  -->
<!-- ```{r SE_Elec_Coal,include=FALSE} -->
<!-- whole_se_coal <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Coal|w/o CCS"))   -->
<!-- hist_se_coal <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005,2010), Variable =="SE|Electricity|Coal (EJ/yr)") -->

<!-- line_type_1(whole_se_coal,hist_se_coal,c(2005,2010)) -->
<!-- line_type_2(whole_se_coal,hist_se_coal,c(2005,2010)) -->

```

