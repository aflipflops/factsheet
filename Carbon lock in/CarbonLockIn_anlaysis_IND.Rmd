---
title: "Carbon Lock-in task CD LINKS"
author: "Aman Malik and Chirstoph Bertram"
date: "17 September 2018"
output: html_document
---


```{r setup, include=FALSE}
# setting global settings for knitr
# echo=TRUE/FALSE whether to include R source code in the output file
# knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.show = "hold",fig.path = "figure-carbonlockin/")
```


```{r message=FALSE, warning=FALSE, include=FALSE,results='hide'}
library(quitte)
library(moinput)
library(tidyr)
library(ggplot2)
library(readr)
library(dplyr)
library(tidyverse)
library(reshape)
library(data.table)
```

```{r echo=FALSE,results='hide',message=FALSE,purl=FALSE}

#read in data
# all <- invisible(fread("cdlinks_compare_20180508-032045.csv",header=TRUE)) #seems to be missing the V3 variants
# all <- invisible(fread("cdlinks_compare_20180810-010937.csv",header=TRUE)) #only MESSAGE
# all <- invisible(fread("cdlinks_compare_20180720-122848.csv",header=TRUE)) #only MESSAGE, AIM/CGE, IMAGE3.0, POLES, WITCH
all <- fread(input = "cdlinks_compare_20180615-153808.csv",header = T, sep = ',') #all V3 and V4 scens

#filter for desired set of time series
models <- unique(all$MODEL)
regions <- "IND" # unique(all$REGION)
scens <- unique(all$SCENARIO)
# How were these variables selected?
variables <- as.character(read.csv2("plotstyles_CLI.csv")$name)

all  <- all[all$MODEL %in% models & all$SCENARIO %in% scens & all$REGION %in% regions & all$VARIABLE %in% variables,]

all <- invisible(melt(all,measure.vars=names(all)[grep("[0-9]+",names(all))],variable.name = "period",variable.factor=FALSE))

all$period <- as.numeric(all$period)
all <- all[!period %in% c(1950,1955,1960,1965,1970,1975,1980,1985,1990,1995,2000,2001,2002,2003,2004,2006,2007,2008,2009,2011,2012,2013,2014,2016,2017,2018,2019,2021,2022,2023,2024,2026,2027,2028,2029,2031,2032,2033,2034,2036,2037,2038,2039,2041,2042,2043,2044,2046,2047,2048,2049,2051,2052,2053,2054,2056,2057,2058,2059,2061,2062,2063,2064,2066,2067,2068,2069,2071,2072,2073,2074,2076,2077,2078,2079,2081,2082,2083,2084,2086,2087,2088,2089,2091,2092,2093,2094,2096,2097,2098,2099,2101,2102,2103,2104,2106,2107,2108,2109)]
# Rename columns
setnames(all, "MODEL", "model")
setnames(all, "SCENARIO", "scenario")
setnames(all, "REGION", "region")
setnames(all, "VARIABLE", "variable")
setnames(all, "UNIT", "unit")

all  <- na.omit(all) # remove rows containing NAs

#make variables a factor, so that the order in facets can be manipulated easily
all$variable <- factor(all$variable)

all$model1 <- all$model
all$scenario1 <- all$scenario
all <- unite(all,col="modscen",c("model1","scenario1"),sep = " - ")
#make variables a factor, so that the order in facets can be manipulated easily
all$model <- factor(all$model)
all$scenario <- factor(all$scenario)
all$modscen <- factor(all$modscen)

#get rid of scenarios not interesting for us
scens_other <- c(grep("rec",unique(all$scenario),value=T),
                  grep("USD",unique(all$scenario),value=T),
              grep("Food",unique(all$scenario),value=T))
all <- all[!scenario %in% scens_other]

#get rid of V3 variants for models that have V4
v3scens <- grep("_V3",unique(all$scenario),value=T)
v4scens <- grep("_V4",unique(all$scenario),value=T)
v4mods <- unique(all[scenario %in% v4scens]$model)
all <- rbind(all[!model %in% v4mods],all[model %in% v4mods & scenario %in% v4scens])

all <- all %>% 
  mutate(model_scope=ifelse(model=="India MARKAL"|model=="AIM/Enduse 3.0","national","global"))
fwrite(all,"")
save(all,file="data_IND.RData")
load("data_IND.RData")
```

```{r}
# Relevant historical and bottom-up data 
# historical IEA data (PE, SE, FE,Trade), and CEDS emissions data
setConfig(forcecache = TRUE)
historical <- calcOutput("Historical",aggregate = F)# aggregate = T not working at the moment, use when available
historical <- collapseNames(historical,collapsedim = 1)
hist_IEA_CEDS <- as.data.frame(historical) 
hist_IEA_CEDS <- hist_IEA_CEDS[,-1]
# Format "Region"   "Year"  "Source"   "Variable" "Value"
names(hist_IEA_CEDS)[c(3,4)] <- c("Source","Variable")
# historical Renewable Energy Capacity data 
hist_IRENA_cap <- as.data.frame(calcOutput("Capacity",aggregate = T))
hist_IRENA_cap <- hist_IRENA_cap[,-1]
hist_IRENA_cap$Source <- "IRENA"
hist_IRENA_cap <- hist_IRENA_cap[,c(1,2,5,3,4)]
names(hist_IRENA_cap) <- names(hist_IEA_CEDS)

# nuclear bottom-up data
nuclear_IAEA <- as.data.frame(calcOutput("CapacityNuclear",aggregate = T))
nuclear_IAEA <- nuclear_IAEA[,-1]
nuclear_IAEA$Source <- "IEA"
nuclear_IAEA <- nuclear_IAEA[,c(1,2,5,3,4)]
names(nuclear_IAEA) <- names(hist_IEA_CEDS)
# coal plants bottom up data
coal_EndCoal <- as.data.frame(readSource("EndCoal"))
coal_EndCoal <- coal_EndCoal[,-1]
coal_EndCoal$Year <- "2018"
coal_EndCoal$Source <- "EndCoal"
coal_EndCoal <- coal_EndCoal[,c(1,2,5,3,4)]
names(coal_EndCoal) <- names(hist_IEA_CEDS)
# coal_EndCoal$Value <- as.character(coal_EndCoal$Value)
# IEA_WEO 2016 investment costs
capacity_costs_IEA <- as.data.frame(calcOutput("DiffInvestCosts",aggregate = T))
capacity_costs_IEA <- capacity_costs_IEA[,-1]
capacity_costs_IEA$Source <- "IEA_WEO"
capacity_costs_IEA <- capacity_costs_IEA[,c(1,2,5,3,4)]
names(capacity_costs_IEA) <- names(hist_IEA_CEDS)

# bringing all historical and bottom up data together; format- region, Variable Name, Year, Value
hist_and_botmup <- rbind(hist_IEA_CEDS,hist_IRENA_cap,nuclear_IAEA,capacity_costs_IEA,coal_EndCoal)   


# historical nuclear 
save(hist_and_botmup,file="HistandBotmup.RData")
load("HistandBotmup.RData")
```


### Explanation of scenario names

| Scenario name |  National Models | Global Models  |
|---------------|------------------|----------------|
|Early action|Cumulative national emissions (budget/target) from 2011-2050, climate policy starts in 2020|Cumulative global emissions target of 1000GtC, climate policy starts in 2020|
|Delayed action|Cumulative national emissions (budget/target) from 2011-2050, climate policy starts in 2030|Cumulative global emissions target of 1000GtC, climate policy starts in 2030|


```{r emissions}
# I want to remove the technical names of the scenarios and replace them with understandable names. Moreover, I want to preserve the bigger dataset and not break them into smaller datasets. Then I can plot emissions based on scenarios and models simultaneously.

# Early scenario
plot_early <- all[all$scenario %in% c("NPi2020_1000_V4","NPi2020_1000_V3","NPi2020_low_V3"),]
plot_early <- add_column(plot_early,scen_name = "Early action")
# Delay scenario
plot_delay   <- all[all$scenario %in% c("INDC2030i_1000_V4","INDC2030i_1000_V3","INDC2030_low_V3"),]
plot_delay <-  add_column(plot_delay,scen_name = "Delayed action")
whole <- rbind(plot_early,plot_delay)

```

##### CO2 Emissions
```{r,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE}
#plot emissions lines
plotvar <- "Emissions|CO2"
whole_a <- whole[whole$variable==plotvar,]

# historical emissions //India// Fossil Fuel and Industry
filtered <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005,2010),Variable =="Emi|CO2|Energy (Mt CO2/yr)") 

ggplot()+
  geom_line(data = whole_a , aes(x=period,y=value/1000,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
 
  labs(
    x = "Year" ,
    y = "CO2 Emissions of India (Gt/yr)",
    color = "Model Scope",
    linetype = "Scenario Type"

  ) +
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050),ylim=c(0,8)) +
  annotate(geom = "point",x = c(2005,2010),y=filtered$Value/1000)+
  scale_colour_brewer(palette = "Set1")+
  ggsave(file="CO2emi_IND_nat_glo_scen.png",width=8,height=4)

ggplot()+
  geom_line(data = whole_a %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value/1000,group=interaction(model,scen_name),linetype=scen_name,alpha=model)) +
geom_line(data = whole_a %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value/1000,group=interaction(model,scen_name),color=model,linetype=scen_name)) + 
  labs(
    x = "Year" ,
    y = "CO2 Emissions of India (Gt/yr)",
    color = "Global model",
    linetype = "Scenario Type",
    alpha="National model"
  ) +
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050),ylim=c(0,8)) +
  annotate(geom = "point",x = c(2005,2010),y=filtered$Value/1000)+
  scale_colour_brewer(palette = "Set1")+
  scale_alpha_discrete(range = c(0.95, 0.65))
  ggsave(file="CO2emi_IND_all_scen.png",width=8,height=4)
  
```
**What I want to show in this graph?**

I want to show that there are national and global models, that these are emission trajectories till 2050. There are two scenarios, early action and delayed action. One also gets the idea that there are 2 national models, and that there are 4 lines because of the different scenarios. Calculating no. of global models is difficult (one would have to see all the bold lines. 
The two black dots are the historical emissions only from the energy sector (see how to get the total emissions). 
- The trajectories of national and global models clearly stand out. There is one national model, we don't know which one yet, whose emission profiles is on a higher side of the global emission trakectories, although it is still not the highest.
- Emissions decrease for most global models in both scenarios, whereas for national models they stay the same or even increase (compared to the peak emissions). note, one national model has no peak emissions. 

**What next to do?**
- How to measure how flexible is the model to emission reduction?
- Maybe calculate the carbon budget between 2010 and 2050 for all models, for both scenarios

What information do I want to convey in this graph?
- show all emission trajectories, that there are national and global models, and that there are two scenarios- early and delayed.
So, this will be my first almost finished plot which I am going to use for my discussion. It shows the total CO2 emissions of India in Gt/yr across 9 Global models and 2 national Models. The globel models are coloured, while the national models are black and grey. #The grey lines are unfortunately not very visible. Maybe i can change this a bit by choosing a different backgorund theme(helped  a bit but the grey line is sjust too light, darken it somehow)# Moreover, it also shows the scenarios divided by early action and delayed action, conveying when the mitigation policies start (2020 and 2030 respectively). 

**Observations and Discussion**
NPi represents existing policies till 2020 and continuation of these policies after 2020. NDC represents policies mentioned in NDCs till 2030 and continuation of these policies thereafter. NDC scenarios contains NPi policies + additional policies. Since NDCs start only in 2020, both NDC and NPi should be approximately the same in 2020.
2050 emissions are the same. 

? For _REMIND_, why are NDC emissions higher in 2030 than NPi? NDC should lead to more mitigation than NPi?

? Why are REMIND historical India CO2 emissions so different than historical emissions?

#### Cumulative Emissions 2010-2050

```{r,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE}
whole_b <- whole_a %>% 
  filter(period>2005 & period<2055) %>% 
  group_by(model,scen_name) %>% 
  mutate(cumsum=cumsum(value)/1000) %>% 
  arrange(cumsum,desc(cumsum))


# try 1
ggplot()+
  geom_bar(data=whole_b %>% filter(period==2050) , aes(x=reorder(model,cumsum),y=cumsum, group=interaction(model,scen_name),fill=scen_name,alpha=model_scope),position="dodge", stat = "identity")+
   
  labs(
    x = "Model name" ,
    y = "Cumulative Emissions of India (2011-2050) (Gt/yr)",
    fill = "Scenario Type",
    alpha = "Model Scope"
 
  ) +
  theme_bw()+
  coord_flip()+
  scale_alpha_discrete(range = c(0.95, 0.55))

# try 2
# ggplot()+
#   geom_point(data=whole_b %>% filter(period==2050 & model_scope=="global"),aes(x=model,y=cumsum,color=scen_name))

```
Global models have a 1000 Gt carbon budget (mitigation policy for 2C  between 2011-2100. They run the global models and get particular emission trajectories for India. These models minimise costs, so often developing nations, where mitigation is cheaper and most of the infrastructure has yet to be built get a disproportionate amount of the mitigation effort.  For the well-below 2 °C target, cumulative 2011−2100 net emissions are limited to 1000 Gt CO2, whereas the 1.5 °C scenario has a budget of 400 GtCO2. These budget values represent a likelihood of 66% of staying below 2 °C throughout the 21st century in the 'well below 2 °C' scenarios, as well as 66% of staying below 1.5 °C after 2100 in the 1.5 °C scenario

For the global models, the carbon budget for both the early and delay mitigation scenarios is the same, but till 2100 (and hence it cannot be seen till 2050). For them, the cumulative emissions in 2050 are higher. That the emissions rise without a cliamte policy in place is no surprise, but what is the cause of these rise in emissions?

The national budgets were decided after discussion with the global teams- The global teams gave them a number that they could work with?. 

? Recapitulate how the national budgets were calculated


Each of the two CO2 budget are achieved by iteratively adjusting a global carbon price that is assumed to grow with 5% p.a. until 2060 and linearly thereafter. Regionally fragmented carbon prices in 2020 (for the cost-effective scenarios) or 2030 (for the other scenarios) converge to the globally harmonized carbon price over a 20 year period (see figure S2 in the supplementary material). GHGs other than CO2 are priced equivalently to CO2 throughout the 21st century based on 100 year global warming potentials from IPCC's Fifth Assessment Report.


#### Emissions from the Electricity sector
```{r,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE}
#plot emissions electricity sector 
plotvar <- "Emissions|CO2|Energy|Supply|Electricity"
whole_c <- whole[whole$variable==plotvar,]
# historical emissions //India// Fossil Fuel and Industry
filtered <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005,2010,2015),Variable =="Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)") 

ggplot()+
  geom_line(data = whole_c , aes(x=period,y=value/1000,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
 
  labs(
    x = "Year" ,
    y = "CO2 Emissions Electricity (Gt/yr)",
    color = "Model Scope",
    linetype = "Scenario Type")+
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050),ylim=c(-1.0,2.5)) +
  annotate(geom = "point",x = c(2005,2010,2015),y=filtered$Value/1000)+
  scale_colour_brewer(palette = "Set1")
 ggsave(file="CO2emi_elec_nat_glo_IND.png",width=8,height=4)

ggplot()+
  geom_line(data = whole_c %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value/1000,group=interaction(model,scen_name),linetype=scen_name,alpha=model)) +
geom_line(data = whole_c %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value/1000,group=interaction(model,scen_name),color=model,linetype=scen_name)) + 
  labs(
    x = "Year" ,
    y = "CO2 Emissions Electricity (Gt/yr)",
    color = "Global model",
    linetype = "Scenario Type",
    alpha="National model"
  ) +  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050),ylim=c(-1.0,2.5)) +
  annotate(geom = "point",x = c(2005,2010,2015),y=filtered$Value/1000)+
  scale_colour_brewer(palette = "Set1")+
  scale_alpha_discrete(range = c(0.95, 0.65))

  ggsave(file="CO2emi_elec_IND.png",width=8,height=4)

```

#### Final Energy of Electricity
```{r,,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE}

plotvar <- "Final Energy|Electricity"
whole_d <- whole[whole$variable==plotvar,]
filtered <- hist_and_botmup %>% filter(Region=="IND", Year %in% c(2005,2010),Variable =="FE|Electricity (EJ/yr)") 

ggplot()+
  geom_line(data = whole_d , aes(x=period,y=value/1000,group=interaction(model,scen_name),linetype=scen_name,color=model_scope)) +
   labs(
    x = "Year" ,
    y = "Final Energy Electricity (EJ/yr)",
    color = "Model Scope",
    linetype = "Scenario Type")+
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050),ylim=c(0,0.04))+ 
  annotate(geom = "point",x = c(2005,2010),y=filtered$Value/1000)

ggplot()+
  geom_line(data = whole_d %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value/1000,group=interaction(model,scen_name),linetype=scen_name,alpha=model)) +
geom_line(data = whole_d %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value/1000,group=interaction(model,scen_name),color=model,linetype=scen_name)) + 
  labs(
    x = "Year" ,
    y = "Final Energy Electricity (EJ/yr)",
    color = "Global model",
    linetype = "Scenario Type",
    alpha="National model"
  ) +  theme_bw()+ 
  annotate(geom = "point",x = c(2005,2010),y=filtered$Value/1000)+
  scale_colour_brewer(palette = "Set1")+
  coord_cartesian(xlim = c(2005,2050),ylim=c(0,0.04))+ 
  scale_alpha_discrete(range = c(0.95, 0.65))+
  # coord_cartesian(xlim = c(2005,2050))
  ggsave(file="FEelec_IND.png",width=8,height=4)
  # geom_line(data = whole_d,aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=scen_name)) +
  # labs(
  #   x = "Year" ,
  #   y = "Final Energy Electricity (EJ/yr)",
  #   color = "Model name",
  #   linetype = "Scenario Type"
  # ) +
  # coord_cartesian(xlim = c(2005,2050),ylim=c(0,30)) +
  # annotate(geom = "point",x = c(2005,2010),y=hist_ind$Value)+
  # # scale_colour_brewer(palette = "Set1")+
  # theme_light()
  ggsave(file="FEelec_IND.png",width=8,height=4)
```

#### Capital Cost
```{r}
#plot capital cost
plotvar <- "Capital Cost|Electricity|Solar|PV"
whole_d <- whole[variable==plotvar,]
localrate = 0.015 #https://www.xe.com/currencycharts/?from=INR&to=USD&view=10Y
whole_d[model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value <- whole_d[model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value*localrate

ggplot()+
  geom_line(data = whole_d,aes(x=period,y=value,group=interaction(model,scen_name),color=model)) +
  labs(
    x = "Year" ,
    y = "Tech Cost PV ($/W)",
    color = "Model name",
    linetype = "Scenario Type"
  ) +
  coord_cartesian(xlim = c(2005,2050)) +
  # scale_colour_brewer(palette = "Set1")+
  theme_light()
ggsave(file="CapCostPV_IND.png",width=8,height=4)
```

#### Secondary Energy from Coal 
```{r}
plotvar <- "Secondary Energy|Electricity|Coal|w/o CCS"
whole_e <- whole[variable==plotvar,]    
hist_ind <- as.data.frame(historical["IND",c(2005,2010),"historical.IEA.SE|Electricity|Coal (EJ/yr)"])
hist_ind$Year <-as.numeric(as.character(hist_ind$Year))
ggplot()+
  geom_line(data = whole_e,aes(x=period,y=value,group=interaction(model,scen_name),color=model)) +
  labs(
    x = "Year" ,
    y = "Unabated Coal Power (EJ/yr)",
    color = "Model name",
    linetype = "Scenario Type"
  ) + 
  coord_cartesian(xlim = c(2005,2050)) +
  # geom_point(data=hist_ind,aes(x = Year,y = Value),color=Value)+
  annotate(geom = "point",x = c(2005,2010),y=hist_ind$Value)+
  # scale_colour_brewer(palette = "Set1")+
  theme_light()
ggsave(file="UnabatedCoal_IND.png",width=8,height=4)
```
#### Coal Power Capacity
```{r}
#plot Coal power capacity
plotvar <- "Capacity|Electricity|Coal|w/o CCS"
whole_f <- whole[variable==plotvar,]    
coal <- hist_and_botmup%>%
  filter(grepl("Operating|Constr|Announced",Variable),Region=="IND")
ggplot()+
  geom_line(data = whole_f,aes(x=period,y=value,group=interaction(model,scen_name),color=model)) +
  labs(
    x = "Year" ,
    y = "Unabated Coal Power (GW)",
    color = "Model name",
    linetype = "Scenario Type"
  ) +
  coord_cartesian(xlim = c(2005,2050)) +
  # scale_colour_brewer(palette = "Set1")+
  theme_light()
ggsave(file="UnabatedCoalGW_IND.png",width=8,height=4)
```


```{r}
#Power generation in 2030
plotvar <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
             "Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Geothermal",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Ocean",
             "Secondary Energy|Electricity|Oil",
             "Secondary Energy|Electricity|Other",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind")

whole_g <-whole[variable %in% plotvar & period==2030,]
whole_h <- whole[variable %in% "Secondary Energy|Electricity" & period==2030,]

source("plotstyle.R")

ggplot()+
  geom_bar(data = whole_g,aes(x=modscen,y=value,group=interaction(model,variable),fill=variable),stat="identity") +
  scale_fill_manual(values=plotstyle(plotvar))  + xlab("Model - Scenario")+
  geom_text(data=whole_g,aes(x=modscen,y=25,label=modscen,angle=90,hjust="right"),color="red",size=2.5)+
  geom_point(data=whole_f,aes(x=modscen,y=value))+ylim(0,25)+
  theme_bw()+ylab("Secondary Energy Electricity (EJ/yr)")
```

```{r}
head(hist_and_botmup%>%
  filter(grepl("Operating|Constr|Announced",Variable),Region=="IND"))
```

# Power capacity in 2030
```{r}
#Power capacity in 2030
plotvar <- c("Capacity|Electricity|Biomass|w/ CCS",
             "Capacity|Electricity|Biomass|w/o CCS",
             "Capacity|Electricity|Coal|w/ CCS",
             "Capacity|Electricity|Coal|w/o CCS",
             "Capacity|Electricity|Gas|w/ CCS",
             "Capacity|Electricity|Gas|w/o CCS",
             "Capacity|Electricity|Geothermal",
             "Capacity|Electricity|Hydro",
             "Capacity|Electricity|Nuclear",
             "Capacity|Electricity|Ocean",
             "Capacity|Electricity|Oil",
             "Capacity|Electricity|Other",
             "Capacity|Electricity|Solar",
             "Capacity|Electricity|Wind")

whole_i <- whole[variable %in% plotvar & period==2030,]
coal <- hist_and_botmup%>%
  filter(grepl("Operating|Constr|Announced",Variable),Region=="IND")
whole_j <- whole[period==2030 & variable %in% "Capacity|Electricity|Solar|PV" & model %in% c("AIM V2.1","AIM/CGE","DNE21+ V.14", "REMIND-MAgPIE 1.7-3.0"),]

whole_j$variable <- "Capacity|Electricity|Solar"

whole_k <- whole[variable %in% "Capacity|Electricity|Wind|Onshore" &
                model %in% c("DNE21+ V.14"),]
whole_k$variable <- "Capacity|Electricity|Wind"

whole_i <- rbind(whole_i,whole_j,whole_k)

whole_l <- whole[period==2030 & variable %in% "Capacity|Electricity" ,]

ggplot()+
  geom_bar(data=whole_i,aes(x=model,y=value,group=interaction(scen_name,variable,model),fill=variable),stat="identity")+
  scale_fill_manual(values=plotstyle(plotvar))+
  xlab("Model - Scenario")+
  geom_text(data=whole_i,aes(x=model,y=1200,label=scen_name,hjust="right"),color="red",size=2.5)+
  ylim(0,1300)+ theme_bw()+ylab("Power Capacity (GW)")+ 
# geom_point(data=whole_l,aes(x=modscen,y=value))
ggsave(file="Capacity_IND.png",width=8,height=5)

```